{% extends "base.html" %}
{% block content %}
<section class="dashboard">
  <div class="stats">
    <div class="stat-card">
      <p class="stat-label">Всего задач</p>
      <p class="stat-value">{{ total }}</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Ежедневные</p>
      <p class="stat-value">{{ navbooks | selectattr("kind", "equalto", "daily") | list | length }}</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Обычные</p>
      <p class="stat-value">{{ navbooks | selectattr("kind", "equalto", "task") | list | length }}</p>
    </div>
  </div>

  <div class="panel">
    <h2>Создание задач</h2>
    <div class="action-grid">
      <details class="action-card">
        <summary class="button button--primary">Создать задачу</summary>
        <form class="form" action="/navbooks/create" method="post">
          <input type="hidden" name="kind" value="task" />
          <label>
            Название
            <input type="text" name="title" placeholder="Например, подготовить отчёт" required />
          </label>
          <label>
            Описание
            <input type="text" name="description" placeholder="Что нужно сделать" />
          </label>
          <button class="button" type="submit">Сохранить</button>
        </form>
      </details>
      <details class="action-card">
        <summary class="button button--ghost">Ежедневная задача</summary>
        <form class="form" action="/navbooks/create" method="post">
          <input type="hidden" name="kind" value="daily" />
          <label>
            Название
            <input type="text" name="title" placeholder="Например, зарядка" required />
          </label>
          <label>
            Описание
            <input type="text" name="description" placeholder="Время или детали" />
          </label>
          <button class="button button--primary" type="submit">Сохранить</button>
        </form>
      </details>
    </div>
  </div>

  <div class="panel">
    <h2>Таблица задач</h2>
    {% if navbooks %}
    <div class="table-wrapper">
      <table class="task-table">
        <thead>
          <tr>
            <th>Тип</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Создано</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for item in navbooks %}
          <tr>
            <td>
              <span class="status status--{{ item.kind }}">
                {{ "Ежедневная" if item.kind == "daily" else "Обычная" }}
              </span>
            </td>
            <td>{{ item.title }}</td>
            <td>{{ item.description or "Без описания" }}</td>
            <td>{{ item.created_at }}</td>
            <td>
              <details>
                <summary class="button button--ghost">Редактировать</summary>
                <form class="form form--stack" action="/navbooks/{{ item.id }}/edit" method="post">
                  <label>
                    Название
                    <input type="text" name="title" value="{{ item.title }}" />
                  </label>
                  <label>
                    Описание
                    <input type="text" name="description" value="{{ item.description }}" />
                  </label>
                  <button class="button button--primary" type="submit">Сохранить</button>
                </form>
              </details>
              <form class="inline-form" action="/navbooks/{{ item.id }}/delete" method="post">
                <button class="button button--danger" type="submit">Удалить</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="muted">Пока нет задач. Создайте первую.</p>
    {% endif %}
  </div>
</section>
{% endblock %}
